(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{RNiq:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return _}));var n=a("1OyB"),o=a("vuIU"),c=a("JX7q"),s=a("Ji7U"),r=a("md7G"),i=a("foSv");function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var u=a("8Kt/"),m=a.n(u),h=a("q1tI"),f=a.n(h),d=a("AmLT"),g=a.n(d),p=a("vDqi"),b=a.n(p),v=(a("Gpft"),a("VFWX")),w=f.a.createElement;function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Object(i.a)(e);if(t){var o=Object(i.a)(this).constructor;a=Reflect.construct(n,arguments,o)}else a=n.apply(this,arguments);return Object(r.a)(this,a)}}var y=new g.a,S="https://pagenote.logike.cn",_=function(e){Object(s.a)(a,e);var t=k(a);function a(e){var o;return Object(n.a)(this,a),o=t.call(this,e),l(Object(c.a)(o),"fetchPages",(function(){(o.setState({loading:!0}),!0!==o.useCacheData())?(y.getIssues("rowthan","rowthan.github.io").listIssues({sort:"created",direction:"desc",state:"open",labels:"pagenote"},(function(e,t){if(o.setState({loading:!1}),e&&(console.error("\u5931\u8d25",e),o.useCacheData(!0)),t){var a=new Date,n=[],c={};t.forEach((function(e){e.labels.forEach((function(e){c[e.id]||(n.push(e),c[e.id]=!0)}))})),o.setState({pages:t||[],fetchTime:a,labels:n}),sessionStorage.setItem("cache_time",a.getTime().toString()),sessionStorage.setItem("cache_pages",JSON.stringify(t))}})).catch((function(e){console.log("\u52a0\u8f7d\u5931\u8d25"),o.useCacheData(!0),o.setState({loading:!1})})),o.setState({loading:!0})):o.setState({loading:!1})})),l(Object(c.a)(o),"fetchLabels",(function(){})),l(Object(c.a)(o),"useCacheData",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=sessionStorage.getItem("cache_pages"),a=parseInt(sessionStorage.getItem("cache_time")||""),n=a+3e5>(new Date).getTime();if(t&&a&&(n||e)){var c=JSON.parse(t);return o.setState({pages:c}),!0}return!1})),l(Object(c.a)(o),"checkLogin",(function(){(y=new g.a({token:localStorage.getItem("token")})).getUser().getProfile((function(e,t){e||o.setState({userInfo:t})}))})),l(Object(c.a)(o),"refreshToken",(function(){var e=window.location.search.match(/code=(.*)$/);e&&b()({method:"post",headers:{Accept:"application/json"},url:"https://cors-anywhere.herokuapp.com/https://github.com/login/oauth/access_token",data:{client_id:"c4aae381097464aa1024",client_secret:"ed40211bca3ccabd900586079b89fd0ec1ea48be",code:e[1]}}).then((function(e){var t=e.data.access_token;localStorage.setItem("token",t),window.location="/"}))})),l(Object(c.a)(o),"filterLabel",(function(){})),l(Object(c.a)(o),"loadComments",(function(e,t){var a=o.state.pages;if(a[t].comment&&a[t].comment.show)return a[t].comment.show=!1,void o.setState({pages:a});y.getIssues("rowthan","rowthan.github.io").listIssueComments(e,(function(e,n){a[t].comment={show:!0,comments:n},o.setState({pages:a})}))})),o.state={pages:[],userInfo:{},fetchTime:new Date,loading:!1,labels:[],filterLabels:["pagenote"]},o}return Object(o.a)(a,[{key:"componentDidMount",value:function(){this.checkLogin(),this.refreshToken(),this.fetchPages()}},{key:"render",value:function(){var e=this,t=this.state,a=t.pages,n=t.userInfo,o=t.loading,c=t.labels,s="https://github.com/login/oauth/authorize?scope=user%20public_repo&client_id=c4aae381097464aa1024&redirect_uri=".concat(S);return w("div",{className:"pagenote"},w(m.a,null,"\u53d1\u73b0"),w("section",{className:"header"},n.name?w("a",{href:n.html_url},w("img",{width:40,height:40,src:n.avatar_url,alt:"".concat(n.name)})):w("a",{id:"user",href:s},"\u767b\u5f55")),w("div",{id:"container"},w("section",{className:"filter-labels"},c.map((function(t){return w(N,{onClick:e.filterLabel,key:t.name,text:t.name,color:t.color})}))),a.map((function(t,a){return w("section",{className:"new",key:t.number},w("div",{className:"title"},w("a",{className:"title-link",href:"".concat(S,"/snapshot.html?pagenote=").concat(t.number)},t.title),w("a",{className:"author",href:n.html_url},w("img",{width:30,height:30,src:t.user.avatar_url,alt:"".concat(t.user.login)}))),w("div",{className:"content"},w(I,{bodyString:t.body}),w("div",{className:"comments"},t.comment&&t.comment.show&&w("div",null,w("ul",null,t.comment.comments.map((function(e){return w("li",{key:e.id},w("img",{width:20,height:20,src:e.user.avatar_url,alt:""}),e.body)}))),w("div",null,w("a",{target:"_blank",href:t.html_url},"\u6211\u4e5f\u8981\u8bc4\u8bba")))),w("div",{className:"labels"},t.labels.map((function(e){return w(N,{key:e.name,text:e.name,color:e.color})})),w("span",{className:"comments-icon",onClick:function(){return e.loadComments(t.number,a)}},w("svg",{className:"octicon octicon-comment v-align-middle",viewBox:"0 0 16 16",version:"1.1",width:"16",height:"16","aria-hidden":"true"},w("path",{fillRule:"evenodd",d:"M14 1H2c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1h2v3.5L7.5 11H14c.55 0 1-.45 1-1V2c0-.55-.45-1-1-1zm0 9H7l-2 2v-2H2V2h12v8z"})),w("span",null,t.comments)))))}))),o&&w(v.a,null))}}]),a}(h.Component);function N(e){var t=e.text,a=e.color,n=.2126*parseInt(a.substr(0,2),16)+.7152*parseInt(a.substr(2,2),16)+.0722*parseInt(a.substr(4,2),16)<128?"#fff":"#000";return w("span",{className:"label",style:{background:"#".concat(a),color:"".concat(n)}},t)}function I(e){var t=e.bodyString,a={steps:[]};try{a=JSON.parse(t)}catch(n){}return w("div",{className:"lights"},a.steps.map((function(e,t){return w("div",{className:"light",key:a.url+t,style:{borderColor:e[5]}},e[3])})))}},vlRD:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a("RNiq")}])}},[["vlRD",0,1,4,2]]]);